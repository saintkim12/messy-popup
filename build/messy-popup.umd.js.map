{"version":3,"file":"messy-popup.umd.js","sources":["../src/messy-popup.ts"],"sourcesContent":["import { DefaultPopupConfig, OptionalDefaultPopupConfig, PopupConfig } from './types/PopupConfig'\nimport { PopupHTMLElement } from './types/PopupElement'\nimport { PopupDataInfo, PopupInstance } from './types/PopupInstance'\n\nconst contentAttrName = 'data-messy-content'\n// const vname = 'MessyPopup'\nconst aname = 'messyPopup'\nconst dataDraggableHandle = 'data-messy-draggable-handle'\nconst globalWrapperClassName = 'messy-popup'\n\n// utils\nclass HTMLElementUtil {\n  convertTextToElement(str: string): Element | null {\n    const div = document.createElement('div')\n    div.innerHTML = str\n    return div.firstElementChild\n  }\n  show(el: PopupHTMLElement): PopupHTMLElement {\n    el.style.visibility = ''\n    return el\n  }\n  hide(el: PopupHTMLElement): PopupHTMLElement {\n    el.style.visibility = 'hidden'\n    return el\n  }\n  destroy(el: PopupHTMLElement): PopupHTMLElement {\n    return el.parentNode?.removeChild(el) ?? el\n  }\n  setDraggable(el: PopupHTMLElement, set?: boolean): PopupHTMLElement {\n    const unset = set === false\n    unset ? this.unbindDraggable.call(el, el) : this.bindDraggable.call(el, el)\n    return el\n  }\n\n  // CSS 삽입\n  insertCss(css: string): boolean {\n    // 기존 sheet 사용\n    const sheet: CSSStyleSheet | undefined =\n      Array.from(document.styleSheets).find((sh) => sh.href === null) ||\n      (() => {\n        // 등록가능한 sheet가 없는 경우\n        const style = document.createElement('style')\n        style.setAttribute('data-messy-popup', 'true')\n        document.querySelector('head')?.appendChild(style)\n        return Array.from(document.styleSheets).find((sh) => sh.href === null)\n      })()\n    return sheet ? sheet.insertRule(css, sheet.cssRules.length) >= 0 : false\n  }\n  // draggable 속성 해제\n  unbindDraggable(elmnt: HTMLElement): void {\n    const targetElement: HTMLElement = elmnt.querySelector('[' + dataDraggableHandle + ']') ?? elmnt\n    targetElement.onmousedown = null\n  }\n  // draggable 속성 연결\n  bindDraggable(elmnt: HTMLElement): void {\n    // from https://www.w3schools.com/howto/howto_js_draggable.asp\n    let pos1 = 0\n    let pos2 = 0\n    let pos3 = 0\n    let pos4 = 0\n\n    const targetElement: HTMLElement = elmnt.querySelector('[' + dataDraggableHandle + ']') ?? elmnt\n    targetElement.onmousedown = dragMouseDown\n\n    function dragMouseDown(e: MouseEvent): void {\n      // e = e || window.event;\n      e.preventDefault()\n      // get the mouse cursor position at startup:\n      pos3 = e.clientX\n      pos4 = e.clientY\n      document.onmouseup = closeDragElement\n      // call a function whenever the cursor moves:\n      document.onmousemove = elementDrag\n    }\n\n    function elementDrag(e: MouseEvent): void {\n      // e = e || window.event;\n      e.preventDefault()\n      // calculate the new cursor position:\n      pos1 = pos3 - e.clientX\n      pos2 = pos4 - e.clientY\n      pos3 = e.clientX\n      pos4 = e.clientY\n      // set the element's new position:\n      // convert bottom to top\n      if (elmnt.style.bottom) {\n        elmnt.style.top = elmnt.offsetTop + 'px'\n        elmnt.style.bottom = ''\n      }\n      // convert right to left\n      if (elmnt.style.right) {\n        elmnt.style.left = elmnt.offsetLeft + 'px'\n        elmnt.style.right = ''\n      }\n      elmnt.style.top = elmnt.offsetTop - pos2 + 'px'\n      elmnt.style.left = elmnt.offsetLeft - pos1 + 'px'\n    }\n\n    function closeDragElement(): void {\n      // stop moving when mouse button is released:\n      document.onmouseup = null\n      document.onmousemove = null\n    }\n  }\n}\nclass MessyPopupInstance implements PopupInstance {\n  public popupInfo: PopupDataInfo\n  private _config: DefaultPopupConfig\n  public instanceConfig: DefaultPopupConfig | undefined\n\n  private htmlUtil: HTMLElementUtil\n\n  constructor() {\n    this.htmlUtil = new HTMLElementUtil()\n    this.popupInfo = {}\n    this.instanceConfig = undefined\n    this._config = {\n      root: 'body',\n      wrapper: ((): HTMLElement => document.createElement('div'))(),\n      global: {\n        // hide: true,\n        draggable: true,\n        style: {\n          zIndex: 1000,\n        },\n      },\n    }\n  }\n\n  init(): this {\n    const cssList = [\n      `.${globalWrapperClassName} { background-color: #fff; }`,\n      // `.${globalWrapperClassName} [data-messy-content] { height: 100%; }`,\n    ]\n    cssList.forEach(this.htmlUtil.insertCss)\n\n    return this\n  }\n\n  addPopupInfo(id: string, el: PopupHTMLElement): void {\n    this.popupInfo[id] = el\n  }\n  removePopupInfo(id: string): void {\n    delete this.popupInfo[id]\n  }\n\n  // setConfig(customConfig: undefined): this\n  // setConfig(customConfig: OptionalDefaultPopupConfig): this\n  setConfig(customConfig: OptionalDefaultPopupConfig): this {\n    const getDefinedValue = <T>(...args: Array<T | undefined>): T | undefined => args.find((arg) => arg !== undefined)\n    // const wrapObj = function(key, value) {\n    //   var _o = {}\n    //   _o[key] = value\n    //   return _o\n    // }\n    // const wrapObj = (k: string, v: any): object => ({ [k]: v })\n    const defaultConfig: DefaultPopupConfig = this._config\n    const currentConfig: DefaultPopupConfig = {\n      root: getDefinedValue(customConfig?.root, defaultConfig.root),\n      wrapper: getDefinedValue(customConfig?.wrapper, defaultConfig.wrapper),\n      global: {\n        draggable: getDefinedValue(customConfig?.global?.draggable, defaultConfig.global.draggable),\n        style: {\n          zIndex: getDefinedValue(customConfig?.global?.style?.zIndex, customConfig?.global?.zIndex /* 설정 alias */, defaultConfig?.global?.style?.zIndex),\n\n          top: getDefinedValue(customConfig?.global?.style?.top, defaultConfig.global.style?.top),\n          left: getDefinedValue(customConfig?.global?.style?.left, defaultConfig.global.style?.left),\n          bottom: getDefinedValue(customConfig?.global?.style?.bottom, defaultConfig.global.style?.bottom),\n          right: getDefinedValue(customConfig?.global?.style?.right, defaultConfig.global.style?.right),\n          position: getDefinedValue(customConfig?.global?.style?.position, defaultConfig.global.style?.position),\n          width: getDefinedValue(customConfig?.global?.style?.width, defaultConfig.global.style?.width),\n          height: getDefinedValue(customConfig?.global?.style?.height, defaultConfig.global.style?.height),\n        },\n      },\n    }\n    this.instanceConfig = currentConfig\n    return this\n  }\n\n  createPopup(...popupConfigList: Array<PopupConfig>): this {\n    const config: DefaultPopupConfig = <DefaultPopupConfig>this.instanceConfig\n    const body: Element = <Element>document.querySelector(config.root ?? '')\n\n    popupConfigList\n      .filter((item) => item.id)\n      .map((item: PopupConfig): [PopupHTMLElement, PopupConfig] => {\n        const { id, wrapper, content, style = {} } = item\n        const { zIndex: globalZIndex } = config.global\n\n        const div: PopupHTMLElement = <PopupHTMLElement>(wrapper === undefined ? config.wrapper : this.htmlUtil.convertTextToElement(wrapper))?.cloneNode(true)\n        div.id = id\n        div.classList.add(globalWrapperClassName)\n\n        const contentDiv: Element =\n          div.querySelector(`[${contentAttrName}]`) ??\n          (() => {\n            div.setAttribute(contentAttrName, '') /* wrapper 자신을 contentDiv로 지정 */\n            return div\n          })()\n        contentDiv.innerHTML = content\n        div.dataset[aname] = ''\n        // console.log('style', style)\n        // div.dataset[aname + 'Id'] = id\n        div.style.top = style?.top?.toString() || ''\n        div.style.left = style?.left?.toString() || ''\n        div.style.bottom = style?.bottom?.toString() || ''\n        div.style.right = style?.right?.toString() || ''\n        div.style.position = style?.position || 'absolute'\n        div.style.zIndex = ((zIndex) => {\n          switch (typeof zIndex) {\n          case 'undefined':\n            return ''\n          case 'number':\n            return `${zIndex}`\n          default:\n            return zIndex\n          }\n        })(style?.zIndex || style?.['z-index'] || globalZIndex)\n\n        // FIXME: 테스트, wrapper의 최상위 자식 노드로 고정\n        const child: HTMLElement | null = div.querySelector(`[${contentAttrName}] > *:first-child`)\n        if (child) {\n          child.style.width = style?.width?.toString() || ''\n          child.style.height = style?.height?.toString() || ''\n        }\n\n        // 초기 생성시에는 안보이도록\n        div.style.visibility = 'hidden'\n\n        // 메소드 바인딩\n        div.show = () => this.htmlUtil.show(div)\n        div.hide = () => this.htmlUtil.hide(div)\n        div.destroy = () => {\n          this.removePopupInfo(id)\n          return this.htmlUtil.destroy(div)\n        }\n        div.setDraggable = () => this.htmlUtil.setDraggable(div)\n        div.unsetDraggable = () => this.htmlUtil.setDraggable(div, false)\n\n        this.addPopupInfo(id, div)\n        return [div, item]\n      })\n      .map(([popup, item]: [PopupHTMLElement, PopupConfig]): PopupHTMLElement => {\n        const getBooleanFunctionalValue = (...args: Array<(() => boolean | undefined) | boolean | undefined>) => {\n          for (const arg of args) {\n            const value = typeof arg === 'function' ? arg() : arg\n            if (typeof value === 'boolean') return value\n            // else continue\n          }\n          return\n        }\n        const draggable: boolean = getBooleanFunctionalValue(item.draggable, config.global.draggable) ?? false\n        const show: boolean = <boolean>(() => {\n          // 우선도에 따른 조회값(item.show, global.show, !item.hide, !global.hide, true)에 따라 리턴\n          return getBooleanFunctionalValue(\n            item.show,\n            () => (typeof item.hide === 'boolean' ? !item.hide : undefined),\n            config.global.show,\n            () => (typeof config.global.hide === 'boolean' ? !config.global.hide : undefined),\n            true\n          )\n        })()\n\n        body.appendChild(popup)\n        if (draggable) popup.setDraggable()\n        if (show) popup.show()\n        return popup\n      })\n    return this\n  }\n  getPopup(id: string): PopupHTMLElement {\n    return this.popupInfo[id]\n  }\n  show(id: string): this {\n    const el = this.getPopup(id)\n    el.show()\n    return this\n  }\n  hide(id: string): this {\n    const el = this.getPopup(id)\n    el.hide()\n    return this\n  }\n  destroy(id: string): this {\n    const el = this.getPopup(id)\n    el.destroy()\n    return this\n  }\n  destroyAll(): this {\n    Object.keys(this.popupInfo).forEach(this.destroy)\n    return this\n  }\n  setDraggable(id: string): this {\n    const el = this.getPopup(id)\n    el.setDraggable()\n    return this\n  }\n  unsetDraggable(id: string): this {\n    const el = this.getPopup(id)\n    el.unsetDraggable()\n    return this\n  }\n  unsetDraggableAll(): this {\n    Object.keys(this.popupInfo).forEach(this.unsetDraggable)\n    return this\n  }\n  getPopupCount(): number {\n    return Object.keys(this.popupInfo).length\n  }\n  forEach(fn: ([id, el]: [string, PopupHTMLElement], i: number, arr: Array<[string, PopupHTMLElement]>) => void): this {\n    Object.entries(this.popupInfo).forEach(([id, el]: [string, PopupHTMLElement], i: number, arr: Array<[string, PopupHTMLElement]>) => {\n      // fn.apply(this, [el, id, i, arr])\n      return fn.apply(this, [[id, el], i, arr])\n    })\n    return this\n  }\n  \n  // deprecated\n  // 모듈 방식 변경에 따라 불필요할듯?? \n  // noConflict(w: typeof window): this {\n  //  delete w[vname]\n  noConflict(): this {\n    return this\n  }\n  // config(customConfig: undefined): this\n  // config(customConfig: OptionalDefaultPopupConfig): this\n  config(customConfig: OptionalDefaultPopupConfig): this {\n    return this.setConfig(customConfig)\n  }\n}\nconst _MessyPopup = new MessyPopupInstance()\nconst MessyPopup = _MessyPopup.init()\n\nexport default MessyPopup\n"],"names":["contentAttrName","dataDraggableHandle","globalWrapperClassName","convertTextToElement","str","div","document","createElement","innerHTML","firstElementChild","show","el","style","visibility","hide","destroy","parentNode","removeChild","setDraggable","set","this","unbindDraggable","call","bindDraggable","insertCss","css","sheet","Array","from","styleSheets","find","sh","href","setAttribute","querySelector","appendChild","insertRule","cssRules","length","elmnt","onmousedown","pos1","pos2","pos3","pos4","e","preventDefault","clientX","clientY","bottom","top","offsetTop","right","left","offsetLeft","onmouseup","onmousemove","closeDragElement","elementDrag","constructor","htmlUtil","HTMLElementUtil","popupInfo","instanceConfig","_config","root","wrapper","global","draggable","zIndex","init","forEach","addPopupInfo","id","removePopupInfo","setConfig","customConfig","getDefinedValue","args","arg","defaultConfig","currentConfig","position","width","height","createPopup","popupConfigList","config","body","filter","item","map","content","globalZIndex","cloneNode","classList","add","dataset","toString","child","unsetDraggable","popup","getBooleanFunctionalValue","value","getPopup","destroyAll","keys","unsetDraggableAll","getPopupCount","Object","fn","entries","i","arr","apply","noConflict"],"mappings":"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"}